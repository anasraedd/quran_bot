import { Telegraf, Markup } from "telegraf";

// ðŸ” Ø¶Ø¹ Ø§Ù„ØªÙˆÙƒÙ† Ù‡Ù†Ø§
const bot = new Telegraf(process.env.BOT_TOKEN);

// ØªØ®Ø²ÙŠÙ† Ø­Ø§Ù„Ø© ÙƒÙ„ Ø·Ø§Ù„Ø¨
const userState = {};

// Ù‚Ø§Ø¦Ù…Ø© Ø§Ù„Ø³ÙˆØ± (Ù†Ø¸ÙŠÙØ© 100%)
const surahs = [
  "Ø§Ù„ÙØ§ØªØ­Ø©","Ø§Ù„Ø¨Ù‚Ø±Ø©","Ø¢Ù„ Ø¹Ù…Ø±Ø§Ù†","Ø§Ù„Ù†Ø³Ø§Ø¡","Ø§Ù„Ù…Ø§Ø¦Ø¯Ø©","Ø§Ù„Ø£Ù†Ø¹Ø§Ù…",
  "Ø§Ù„Ø£Ø¹Ø±Ø§Ù","Ø§Ù„Ø£Ù†ÙØ§Ù„","Ø§Ù„ØªÙˆØ¨Ø©","ÙŠÙˆÙ†Ø³","Ù‡ÙˆØ¯","ÙŠÙˆØ³Ù","Ø§Ù„Ø±Ø¹Ø¯",
  "Ø¥Ø¨Ø±Ø§Ù‡ÙŠÙ…","Ø§Ù„Ø­Ø¬Ø±","Ø§Ù„Ù†Ø­Ù„","Ø§Ù„Ø¥Ø³Ø±Ø§Ø¡","Ø§Ù„ÙƒÙ‡Ù","Ù…Ø±ÙŠÙ…","Ø·Ù‡",
  "Ø§Ù„Ø£Ù†Ø¨ÙŠØ§Ø¡","Ø§Ù„Ø­Ø¬","Ø§Ù„Ù…Ø¤Ù…Ù†ÙˆÙ†","Ø§Ù„Ù†ÙˆØ±","Ø§Ù„ÙØ±Ù‚Ø§Ù†","Ø§Ù„Ø´Ø¹Ø±Ø§Ø¡",
  "Ø§Ù„Ù†Ù…Ù„","Ø§Ù„Ù‚ØµØµ","Ø§Ù„Ø¹Ù†ÙƒØ¨ÙˆØª","Ø§Ù„Ø±ÙˆÙ…","Ù„Ù‚Ù…Ø§Ù†","Ø§Ù„Ø³Ø¬Ø¯Ø©",
  "Ø§Ù„Ø£Ø­Ø²Ø§Ø¨","Ø³Ø¨Ø£","ÙØ§Ø·Ø±","ÙŠØ³","Ø§Ù„ØµØ§ÙØ§Øª","Øµ","Ø§Ù„Ø²Ù…Ø±",
  "ØºØ§ÙØ±","ÙØµÙ„Øª","Ø§Ù„Ø´ÙˆØ±Ù‰","Ø§Ù„Ø²Ø®Ø±Ù","Ø§Ù„Ø¯Ø®Ø§Ù†","Ø§Ù„Ø¬Ø§Ø«ÙŠØ©",
  "Ø§Ù„Ø£Ø­Ù‚Ø§Ù","Ù…Ø­Ù…Ø¯","Ø§Ù„ÙØªØ­","Ø§Ù„Ø­Ø¬Ø±Ø§Øª","Ù‚","Ø§Ù„Ø°Ø§Ø±ÙŠØ§Øª",
  "Ø§Ù„Ø·ÙˆØ±","Ø§Ù„Ù†Ø¬Ù…","Ø§Ù„Ù‚Ù…Ø±","Ø§Ù„Ø±Ø­Ù…Ù†","Ø§Ù„ÙˆØ§Ù‚Ø¹Ø©","Ø§Ù„Ø­Ø¯ÙŠØ¯",
  "Ø§Ù„Ù…Ø¬Ø§Ø¯Ù„Ø©","Ø§Ù„Ø­Ø´Ø±","Ø§Ù„Ù…Ù…ØªØ­Ù†Ø©","Ø§Ù„ØµÙ","Ø§Ù„Ø¬Ù…Ø¹Ø©","Ø§Ù„Ù…Ù†Ø§ÙÙ‚ÙˆÙ†",
  "Ø§Ù„ØªØºØ§Ø¨Ù†","Ø§Ù„Ø·Ù„Ø§Ù‚","Ø§Ù„ØªØ­Ø±ÙŠÙ…","Ø§Ù„Ù…Ù„Ùƒ","Ø§Ù„Ù‚Ù„Ù…","Ø§Ù„Ø­Ø§Ù‚Ø©",
  "Ø§Ù„Ù…Ø¹Ø§Ø±Ø¬","Ù†ÙˆØ­","Ø§Ù„Ø¬Ù†","Ø§Ù„Ù…Ø²Ù…Ù„","Ø§Ù„Ù…Ø¯Ø«Ø±","Ø§Ù„Ù‚ÙŠØ§Ù…Ø©",
  "Ø§Ù„Ø¥Ù†Ø³Ø§Ù†","Ø§Ù„Ù…Ø±Ø³Ù„Ø§Øª","Ø§Ù„Ù†Ø¨Ø£","Ø§Ù„Ù†Ø§Ø²Ø¹Ø§Øª","Ø¹Ø¨Ø³","Ø§Ù„ØªÙƒÙˆÙŠØ±",
  "Ø§Ù„Ø¥Ù†ÙØ·Ø§Ø±","Ø§Ù„Ù…Ø·ÙÙÙŠÙ†","Ø§Ù„Ø§Ù†Ø´Ù‚Ø§Ù‚","Ø§Ù„Ø¨Ø±ÙˆØ¬","Ø§Ù„Ø·Ø§Ø±Ù‚",
  "Ø§Ù„Ø£Ø¹Ù„Ù‰","Ø§Ù„ØºØ§Ø´ÙŠØ©","Ø§Ù„ÙØ¬Ø±","Ø§Ù„Ø¨Ù„Ø¯","Ø§Ù„Ø´Ù…Ø³","Ø§Ù„Ù„ÙŠÙ„",
  "Ø§Ù„Ø¶Ø­Ù‰","Ø§Ù„Ø´Ø±Ø­","Ø§Ù„ØªÙŠÙ†","Ø§Ù„Ø¹Ù„Ù‚","Ø§Ù„Ù‚Ø¯Ø±","Ø§Ù„Ø¨ÙŠÙ†Ø©",
  "Ø§Ù„Ø²Ù„Ø²Ù„Ø©","Ø§Ù„Ø¹Ø§Ø¯ÙŠØ§Øª","Ø§Ù„Ù‚Ø§Ø±Ø¹Ø©","Ø§Ù„ØªÙƒØ§Ø«Ø±","Ø§Ù„Ø¹ØµØ±",
  "Ø§Ù„Ù‡Ù…Ø²Ø©","Ø§Ù„ÙÙŠÙ„","Ù‚Ø±ÙŠØ´","Ø§Ù„Ù…Ø§Ø¹ÙˆÙ†","Ø§Ù„ÙƒÙˆØ«Ø±","Ø§Ù„ÙƒØ§ÙØ±ÙˆÙ†",
  "Ø§Ù„Ù†ØµØ±","Ø§Ù„Ù…Ø³Ø¯","Ø§Ù„Ø¥Ø®Ù„Ø§Øµ","Ø§Ù„ÙÙ„Ù‚","Ø§Ù„Ù†Ø§Ø³"
];

// /start
bot.start((ctx) => {
  userState[ctx.from.id] = {};
  ctx.reply(
    "ðŸ‘‹ Ù…Ø±Ø­Ø¨Ø§Ù‹ Ø¨Ùƒ\nØ§Ø®ØªØ± Ù†ÙˆØ¹ Ø§Ù„Ø¥Ù†Ø¬Ø§Ø²:",
    Markup.inlineKeyboard([
      [Markup.button.callback("ðŸ“– Ø­ÙØ¸", "TYPE_HIFZ")],
      [Markup.button.callback("ðŸ“˜ Ù…Ø±Ø§Ø¬Ø¹Ø©", "TYPE_REVIEW")]
    ])
  );
});

// Ø§Ø®ØªÙŠØ§Ø± Ù†ÙˆØ¹ Ø§Ù„Ø¥Ù†Ø¬Ø§Ø²
bot.action(["TYPE_HIFZ", "TYPE_REVIEW"], (ctx) => {
  userState[ctx.from.id].type =
    ctx.callbackQuery.data === "TYPE_HIFZ" ? "Ø­ÙØ¸" : "Ù…Ø±Ø§Ø¬Ø¹Ø©";

  ctx.reply("ðŸ“š Ø§Ø®ØªØ± Ø§Ù„Ø³ÙˆØ±Ø©:");
  ctx.reply(
    "â¬‡ï¸",
    Markup.inlineKeyboard(
      surahs.map((s) => [Markup.button.callback(s, `SURAH_${s}`)])
    )
  );
});

// Ø§Ø®ØªÙŠØ§Ø± Ø§Ù„Ø³ÙˆØ±Ø©
bot.action(/SURAH_(.+)/, (ctx) => {
  userState[ctx.from.id].surah = ctx.match[1];
  ctx.reply("ðŸ”¢ Ù…Ù† Ø¢ÙŠØ© Ø±Ù‚Ù…:");
  userState[ctx.from.id].step = "FROM";
});

// Ø¥Ø¯Ø®Ø§Ù„ Ø§Ù„Ø£Ø±Ù‚Ø§Ù…
bot.on("text", (ctx) => {
  const state = userState[ctx.from.id];
  if (!state) return;

  if (state.step === "FROM") {
    state.from = ctx.message.text;
    state.step = "TO";
    return ctx.reply("ðŸ”¢ Ø¥Ù„Ù‰ Ø¢ÙŠØ© Ø±Ù‚Ù…:");
  }

  if (state.step === "TO") {
    state.to = ctx.message.text;
    state.step = null;

    const msg =
      `ðŸ“Œ ØªÙ‚Ø±ÙŠØ± Ø§Ù„Ø¥Ù†Ø¬Ø§Ø²\n\n` +
      `ðŸ“– Ø§Ù„Ù†ÙˆØ¹: ${state.type}\n` +
      `ðŸ“˜ Ø§Ù„Ø³ÙˆØ±Ø©: ${state.surah}\n` +
      `ðŸ”¢ Ù…Ù† Ø¢ÙŠØ©: ${state.from}\n` +
      `ðŸ”¢ Ø¥Ù„Ù‰ Ø¢ÙŠØ©: ${state.to}`;

    ctx.reply(msg);
  }
});

// ØªØ´ØºÙŠÙ„ Ø§Ù„Ø¨ÙˆØª
bot.launch();
console.log("ðŸ¤– Bot is running...");
